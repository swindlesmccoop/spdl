#!/bin/bash

#if [ -z ${SONGS+x} ]; then echo "Please set a SONGS variable in your shell configuration." && exit 1; fi

function search {
    printf "Searching for '$2', please hold...\n\n"
    RESULT=$(curl -s "https://search.stepmaniaonline.net/packs/$2" | grep -o -P '(?<=/link/).*(?=.zip)')
    if [ "$RESULT" == "" ]; then echo "No results found!"; else printf "$RESULT\n\n"; fi
}

function ddl {
    PACK=$(echo "$2" | sed -e 's/ /%20/g')
    #wget "https://search.stepmania.net/static/new/$PACK.zip"
    LINK=$(curl -L -s "https://search.stepmania.net/static/new/$PACK.zip" | sed -e "s/.\{106\}https/ https/g" | sed -e "s/.\{21\}html>/ html>/g" | sed "s/ html>//" | sed "s/^ \(.*\)/\1/")
    #echo "$LINK"
    curl -L "$LINK" -o "$2".zip
}

case "$1" in
    -s) search "$@" ;;
    -d) ddl "$@" ;;
esac

